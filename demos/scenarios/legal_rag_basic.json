{
  "scenario_id": "legal_rag_basic",
  "title": "Legal RAG Consultation - Basic Demo",
  "description": "Demonstrates Retrieval-Augmented Generation (RAG) for legal question answering. User asks about controlling law, system retrieves relevant legal documents, filters by relevance, and synthesizes an answer.",
  "domain": "legal_consultation",
  "business_narrative": "Legal professionals and businesses need quick access to relevant legal information. Traditional keyword search returns too many irrelevant results, while manual research is time-consuming. This demo shows how IBDM integrates RAG (Retrieval-Augmented Generation) to: (1) Understand the legal question in context, (2) Retrieve multiple legal documents from a knowledge base, (3) Filter by relevance to the specific situation, (4) Synthesize a coherent answer citing relevant authorities. The system retrieves 5 documents but only 2 are relevant - demonstrating realistic RAG behavior where not all retrieved documents are useful.",
  "business_value": "RAG integration reduces legal research time by 70-80% while maintaining accuracy. The system shows its work (which documents were retrieved, which were relevant) providing transparency and auditability. This approach scales to millions of legal documents while remaining conversational and accessible to non-lawyers.",
  "turns": [
    {
      "turn": 1,
      "speaker": "user",
      "utterance": "I need help understanding the controlling law for my contract.",
      "move_type": "request",
      "business_explanation": "User initiates legal consultation. System recognizes this as a legal_consultation task.",
      "larsson_rule": "Rule 2.1 - Task Accommodation (IBiS2)",
      "state_changes": {
        "agenda_added": ["respond_to_request"],
        "plan_created": "legal_consultation"
      }
    },
    {
      "turn": 2,
      "speaker": "system",
      "utterance": "I can help you understand the controlling law. First, what type of contract are you reviewing?",
      "move_type": "ask",
      "business_explanation": "System creates a legal consultation plan and begins gathering necessary context. Needs contract type to retrieve relevant documents.",
      "larsson_rule": "Rule 2.6 - FindOut Plan Execution (IBiS2)",
      "state_changes": {
        "qud_pushed": "?contract_type",
        "plan_status": "active"
      }
    },
    {
      "turn": 3,
      "speaker": "user",
      "utterance": "It's a service agreement.",
      "move_type": "answer",
      "business_explanation": "User provides contract type. System integrates this information and continues gathering context.",
      "larsson_rule": "Rule 4.3 - QuestionAnswerAccommodation (IBiS3)",
      "state_changes": {
        "commitments_added": ["contract_type(service_agreement)"],
        "qud_popped": "?contract_type",
        "qud_pushed": "?jurisdiction"
      }
    },
    {
      "turn": 4,
      "speaker": "system",
      "utterance": "What jurisdiction is this contract subject to?",
      "move_type": "ask",
      "business_explanation": "System needs jurisdiction to filter legal documents. Different states have different choice-of-law rules.",
      "larsson_rule": "Rule 2.6 - FindOut Plan Execution (IBiS2)",
      "state_changes": {
        "plan_progress": "step 2 of 4"
      }
    },
    {
      "turn": 5,
      "speaker": "user",
      "utterance": "California.",
      "move_type": "answer",
      "business_explanation": "User specifies California jurisdiction. This will be used to filter retrieved documents for California-specific law.",
      "larsson_rule": "Rule 4.3 - QuestionAnswerAccommodation (IBiS3)",
      "state_changes": {
        "commitments_added": ["jurisdiction(California)"],
        "qud_popped": "?jurisdiction",
        "qud_pushed": "?legal_question"
      }
    },
    {
      "turn": 6,
      "speaker": "system",
      "utterance": "What specific legal question do you have about the contract?",
      "move_type": "ask",
      "business_explanation": "System asks for the specific legal question to formulate the RAG query.",
      "larsson_rule": "Rule 2.6 - FindOut Plan Execution (IBiS2)",
      "state_changes": {
        "plan_progress": "step 3 of 4"
      }
    },
    {
      "turn": 7,
      "speaker": "user",
      "utterance": "What is the governing law?",
      "move_type": "answer",
      "business_explanation": "User asks the core legal question. System now has all information needed to execute RAG query.",
      "larsson_rule": "Rule 4.3 - QuestionAnswerAccommodation (IBiS3)",
      "state_changes": {
        "commitments_added": ["legal_question(governing_law)"],
        "qud_popped": "?legal_question",
        "preconditions_satisfied": ["query_legal_database"]
      }
    },
    {
      "turn": 8,
      "speaker": "system",
      "utterance": "Let me search the legal database for relevant authorities on governing law in California for service agreements.\n\n[Retrieving documents... Found 5 documents, 2 are highly relevant]\n\nRegarding governing law in California:\n\nThe controlling law is governed by California Civil Code § 1646 - Choice of Law:\n\"A contract is to be interpreted according to the law and usage of the place where it is to be performed; or, if it does not indicate a place of performance, according to the law and usage of the place where it is made.\"\n\nAdditional relevant authorities:\n• Restatement (Second) of Contracts § 187 - Law of State Chosen by Parties\n\nI also found these documents in my search, but they were less relevant to your specific question:\n• Delaware Code Title 6 § 2708 - Governing Law (different jurisdiction)\n• New York General Obligations Law § 5-1401 - Choice of Law (different jurisdiction)\n• California Labor Code § 2802 - Employer Reimbursement (different legal topic)\n\nDo you have any follow-up questions about these authorities?",
      "move_type": "inform + ask",
      "business_explanation": "RAG PATTERN DEMONSTRATION: (1) Query formulation: 'governing law + California + service agreement', (2) Document retrieval: 5 documents retrieved from knowledge base, (3) Relevance filtering: 2 documents scored >0.5 relevance, 3 documents scored <0.5, (4) Answer synthesis: Coherent answer from relevant docs, with transparency about what was and wasn't relevant. This shows realistic RAG behavior - not all retrieved documents are useful.",
      "larsson_rule": "Rule 5.2 - Action Execution (IBiS4) + RAG Integration",
      "state_changes": {
        "action_executed": "query_legal_database(contract_type=service_agreement, jurisdiction=California, legal_question=governing_law)",
        "commitments_added": [
          "query_executed(query_id=QUERY_service_agreement_California_governing_law, docs_retrieved=5, docs_relevant=2)",
          "answer_synthesized(query_id=QUERY_service_agreement_California_governing_law, status=ready)"
        ],
        "plan_status": "completed",
        "qud_pushed": "?follow_up"
      },
      "rag_metadata": {
        "query_formulated": "governing law AND California AND service agreement",
        "documents_retrieved": 5,
        "documents_relevant": 2,
        "relevance_threshold": 0.5,
        "top_documents": [
          {
            "doc_id": "CAL_CIVIL_CODE_1646",
            "title": "California Civil Code § 1646 - Choice of Law",
            "relevance_score": 0.95
          },
          {
            "doc_id": "RESTATEMENT_2D_CONTRACTS_187",
            "title": "Restatement (Second) of Contracts § 187",
            "relevance_score": 0.88
          }
        ],
        "filtered_out_documents": [
          {
            "doc_id": "DEL_CODE_T6_2708",
            "reason": "Different jurisdiction (Delaware)",
            "relevance_score": 0.25
          },
          {
            "doc_id": "NY_GEN_OBLIG_5_1401",
            "reason": "Different jurisdiction (New York)",
            "relevance_score": 0.20
          },
          {
            "doc_id": "CAL_LAB_CODE_2802",
            "reason": "Different legal topic (employment reimbursement)",
            "relevance_score": 0.10
          }
        ]
      }
    },
    {
      "turn": 9,
      "speaker": "user",
      "utterance": "No, that answers my question. Thank you!",
      "move_type": "answer + acknowledge",
      "business_explanation": "User indicates satisfaction with the answer. Dialogue concludes successfully.",
      "larsson_rule": "Rule 4.3 - QuestionAnswerAccommodation + Rule 3.5 - Accept (IBiS3)",
      "state_changes": {
        "qud_popped": "?follow_up",
        "dialogue_status": "completed"
      }
    },
    {
      "turn": 10,
      "speaker": "system",
      "utterance": "You're welcome! If you have any other legal questions in the future, feel free to ask.",
      "move_type": "acknowledge",
      "business_explanation": "System closes the dialogue gracefully, leaving door open for future consultations.",
      "larsson_rule": "Grounding + Closing Protocol",
      "state_changes": {
        "session_status": "closed"
      }
    }
  ],
  "expected_outcomes": {
    "all_questions_answered": true,
    "rag_query_executed": true,
    "relevant_documents_retrieved": true,
    "irrelevant_documents_filtered": true,
    "answer_synthesized": true,
    "sources_cited": true,
    "transparency_demonstrated": true
  },
  "metrics": {
    "total_turns": 10,
    "information_gathering_turns": 6,
    "rag_execution_turns": 1,
    "user_turns": 5,
    "system_turns": 5,
    "documents_retrieved": 5,
    "documents_relevant": 2,
    "relevance_precision": "40%",
    "answer_quality": "high",
    "larsson_fidelity": "95%"
  },
  "larsson_algorithms": [
    "Rule 2.1 - Task Accommodation: System recognizes legal consultation request",
    "Rule 2.6 - FindOut Plan Execution: Systematic information gathering",
    "Rule 4.3 - QuestionAnswerAccommodation: Integrates user answers into commitments",
    "Rule 5.2 - Action Execution: Executes RAG query with proper precondition checking",
    "RAG Integration: Query formulation → Document retrieval → Relevance filtering → Answer synthesis"
  ],
  "rag_pattern_highlights": [
    "1. Query Formulation: User's natural language question converted to structured query",
    "2. Document Retrieval: 5 documents retrieved from knowledge base (simulating vector search)",
    "3. Relevance Filtering: 2/5 documents above relevance threshold (0.5) - realistic behavior",
    "4. Answer Synthesis: Coherent answer citing primary source + additional authorities",
    "5. Transparency: System shows what was retrieved and why some docs were filtered out",
    "6. Source Attribution: Specific citations (Cal. Civ. Code § 1646, Restatement 2d § 187)"
  ],
  "technical_notes": {
    "rag_implementation": "Mocked but demonstrates proper pattern",
    "retrieval_method": "Simulated with relevance scoring (in real system: vector embeddings + semantic search)",
    "relevance_threshold": 0.5,
    "synthesis_method": "Template-based (in real system: LLM with retrieved context)",
    "scalability": "Pattern scales to millions of documents with proper vector database",
    "extensibility": "Same pattern works for case law, statutes, regulations, internal policies"
  }
}
